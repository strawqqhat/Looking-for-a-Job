## 常见面试题

#### 1、什么是微服务？

**微服务**

微服务架构是一种架构模式，提倡将单一应用程序划分成一组小的服务，服务之间互相协调，互相配合，为用户提供最终的价值。每个服务运行在其独立的进程中，服务与服务间采用轻量级的通信机制相互协作(通常基于HTTP协议的restful API)。每个服务都围绕着具体业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应当尽量避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建。

**微服务的优缺点**

优点

> 每个服务足够内聚、足够小，代码容易理解，这样能聚焦一个指定的业务功能或业务需求
>
> 开发简单、开发效率提高，一个服务可能就是专一的只干一件事
>
> 微服务能够被小团队单独开发，这个小团队是2到5人的开发人员组成
>
> 微服务是松耦合的，是有功能意义的服务，无论是在开发阶段还是部署阶段都是独立的
>
> 微服务能使用不同的语言开发
>
> 易于和第三方集成，微服务允许容易且灵活的方式集成自动部署，通过持续集成工具，如Jenkins，Hudson，bamboo
>
> 微服务易于被一个开发人员理解、修改和维护，这样小团队能够更关注自己的工作成果。无需通过合作才能体现价值
>
> 微服务允许你融合利用最新技术
>
> 微服务只是业务逻辑的代码，不会和HTML，CSS等其他界面组件混合
>
> 每个微服务都有自己的存储能力，可以有自己的数据库，也可以有统一的数据库

缺点

> 开发人员要处理分布式系统的复杂性
>
> 多服务运维难度，随着服务的增加，运维的压力也在增加
>
> 系统部署依赖
>
> 服务间通信成本
>
> 数据一致性
>
> 系统集成测试
>
> 性能监控



#### 2、微服务之间是如何通讯的？

同步通信

> dubbo通过RPC远程过程调用、springcloud通过rest接口json调用。

异步

> 消息队列，如RabbitMq，ActiveMq，Kafka等。要考虑消息可靠传输、高性能、以及编程模型的变化等。



#### 3、springcloud 与dubbo有哪些区别？

两者都是现在主流的微服务框架。

**SpringCloud**：Spring公司开源的微服务框架，SpirngCloud 定位为微服务架构下的一站式解决方案。

**Dubbo**：阿里巴巴开源的RPC框架，Dubbo 是 SOA 时代的产物，它的关注点主要在于服务的调用，流量分发、流量监控和熔断。

> 初始定位不同：springcloud定位为微服务架构下的一站式解决方案；dubbo是SOA时代的产物，关注点主要在于服务的调用和治理。
>
> 生态环境不同：springcloud依托于Spring平台，具备更加完善的生态体系；而dubbo一开始只是做RPC远程调用，生态相对匮乏，现在主键丰富起来。
>
> 调用方式：springcloud采用HTTP协议做远程调用，接口一般是Rest风格，比较灵活；dubbo是采用dubbo协议，接口一般是java的service接口，格式固定，但调用是采用netty的NIO方式，性能较好。
>
> 组件差异比较多，例如springcloud注册中心一般用Eureka,而dubbo用的是zookeeper。
>
> springcloud 生态丰富，功能完善，更像是品牌机；dubbo则相对灵活，可定制型强，更像是组装机。



#### 4、请谈谈对SpringBoot 和SpringCloud的理解

springcloud是Spring为微服务架构思想做的一个一站式实现。

> 从某种程度可以理解为，微服务是一个概念、一个项目开发的架构思想。springcloud是微服务架构的一种java实现。

springcloud是基于springboot的一套实现微服务的框架。

> 为微服务体系开发中的架构问题提供了一整套的解决方案，它提供了微服务开发所需要的配置管理、服务发现、断路器、智能路由、微代理、控制总线、全局锁、决策竞选、分布式会话和集群状态管理等组件。最重要的是，跟springboot框架一起使用的话，会让开发微服务架构的云服务非常方便。

> springcloud是一个基于springboot实现的云应用开发工具，springboot专注于快速、方便集成的单个个体，springcloud是关注全局的服务治理框架；springboot使用了默认大于配置的理念，很多集成方案已经帮你选择好了，能不配置就不配置，springcloud很大一部分是基于springboot来实现。

springcloud五大核心组件

> 服务注册发现：Netflix Eureka
>
> 配置中心：spring cloud config
>
> 负载均衡：Netflix Ribbon
>
> 断路器：Netflix Hystrix
>
> 路由(网关)：Netflix Zuul

springboot的哲学就是约定大于配置，既然很多东西是一样的，为什么还要去配置。

> 通过starter和依赖管理解决依赖问题。
>
> 通过自动配置解决配置复杂问题。
>
> 通过内嵌web容器，由应用启动tomcat，而不是Tomcat启动应用，来解决部署运行问题。

#### 5、分布式系统面临的问题

复杂分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免地失败。
￼
**服务雪崩**
多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务B和微服务C又调用其它的微服务，这就是所谓的“扇出”。如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的“雪崩效应”。

对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几秒钟内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障。这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。



#### 6、什么是服务熔断，什么是服务降级？

服务雪崩

>多个微服务间调用，假设A调用B，B调用C，C调用其他，这就是“扇出”。如果“扇出”的链路上某个微服务的调用响应时间过长或不可用，对微服务A的调用会占用越来越多的资源，进而引起“雪崩效应”。

服务熔断

> 熔断机制是应对雪崩效应的一种微服务链路保护机制。当调用链路上的某个微服务不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的调用，快速返回错误的响应信息。当检测到该节点微服务调用响应正常后恢复调用链路。在springcloud框架里熔断机制通过Hystrix实现。Hystrix会监控微服务间调用的状况，当失败的调用到一定阈值，默认是5秒内20次调用失败就会启动熔断机制。熔断机制的注解是@HystrixCommand。

服务降级

> 整体资源快不够了，忍痛将某些服务先关掉，待度过难关，再开启回来。



#### 7、微服务的优缺点分别是什么？说下你在项目开发中碰到的坑？



#### 8、你所知道的微服务技术栈有哪些？请列举一二

![在这里插入图片描述](https://img-blog.csdnimg.cn/20190812155937617.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM3NTQ4Mg==,size_16,color_FFFFFF,t_70)



#### 9、什么是 Eureka服务注册与发现

Eureka采用了CS的设计架构，Eureka Server作为服务注册功能的服务器，它是服务注册中心。而系统中的其他微服务，使用Eureka的客户端连接到Eureka Server并维持心跳连接。这样系统的维护人员就能通过Eureka Server来监控系统中各个微服务是否正常运行。

在服务注册与发现中，有一个注册中心。当服务器启动的时候，会把当前自己服务器的信息，比如服务地址、通讯地址等以别名方式注册到注册中心上，另一方(消费者/服务提供者)以该别名的方式去注册中心上获取到实际的服务通讯地址，然后再实现本地RPC调用RPC。

远程调用框架核心设计思想：在于注册中心，因为使用注册中心管理每个服务与服务之间的一个依赖关系。在任何RPC框架中，都会有一个注册中心(存放服务地址相关信息(接口))。



#### 10、Eureka的基本架构是什么？

![img](https://img2020.cnblogs.com/blog/966359/202007/966359-20200718232501861-1105042027.png)

Eureka的两个组件：Euerka Server 和 Eureka Client

Eureka Server提供服务注册服务：

> 各个微服务节点通过配置启动后，会在Eureka Server中进行注册，这样Eureka Server中的服务注册表中将会存储可用服务节点的信息，读物·服务节点的信息可以在界面中直接看到。

Eureka Client通过注册中心进行访问

> 是一个java客户端，用于简化Eureka Server的交互，客户端同时也具备一个内置的、使用轮训负载算法的负载均衡器。在应用启动后，会将向Eureka Server发送心跳(默认周期是30秒)。如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，Eureka Server会从服务注册表找那个把这个服务节点删除(默认90秒)



#### 11、作为服务注册中心，Eureka比Zookeeper好在哪里?

CAP理论指出，一个分布式系统不可能同时满足一致性、可用性和分区容错性。由于分区容错性是分布式系统中必须要保证的，因此我们只需要在A和C之间进行权衡。因此zookeeper保证的是CP，Eureka保证的是AP。

zookeeper保证CP

> 当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟前的注册信息，但不能接受服务之间down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。但是zk会出现这样一种情况，当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间太长，30-120s，且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪，在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的事，虽然服务最终能够恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。

eureka保证AP

> Eureka看明白了这一点，因此在设计时就优先保证可用性。Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册时如果发现连接失败会自动切换至其他节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)。只不过查到的消息可能不是最新的(不保证强一致性)。除此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况：
>
> 1.eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的任务。
>
> 2.eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其他节点上(即保证当前节点依然可用)。
>
> 3.当网络稳定时，当前实例新的注册信息会被同步到其他节点中。
>
> 因此，eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。



#### 12、什么是 Ribbon负载均衡？

Spring cloud ribbon是基于Netflix Ribbon实现的一套客户端负载均衡的工具。

简单的说，Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软件负载均衡算法，将Netflix的中间层服务连接在一起。Ribbon客户端组件提供一系列完整的配置项如连接超时、重试等。简单的说，就是在配置文件中列出Load Balancer后面所有的机器，Ribbon会自动的帮助你基于某种规则(如简单轮训、随机连接等)去连接这些机器，我们也很容易使用Ribbon实现自定义的负载均衡算法。



#### 13、Ribbon负载均衡能干嘛？

负载均衡可以将用户的请求平摊的分配到多个服务上。

集中式LB即在服务的消费方和提供方之间使用独立的LB设施，由该设施负责把访问请求通过某种策略转发至服务的提供方。

进程内负载均衡将负载均衡逻辑集成到消费方，消费方从服务注册中心获知有哪些地址可用，然后再从这些地址中选择一个合适的服务器。

注意：Ribbon就属于进程内负载均衡，它只是一个类库，集成于消费方进程，消费方通过它来获取到服务提供方的地址。



#### 14、什么是 Feign 负载均衡

feign是声明式的web service客户端，它让微服务之间的调用变得更简单了，类似controller调用service。

feign集成了Ribbon和Eureka，可以使用Feign时提供负载均衡的http客户端。只需要创建一个接口，然后添加注解即可。



#### 15、Feign 能干什么

feign旨在使编写java http客户端变得更容易。前面在使用Ribbon+RestTemplate时，利用RestTemplate对HTTP请求的封装处理，形成了一套模板化的调用方法。但在实际开发中，由于对服务依赖的调用可能不止一处，往往一个接口会被多处调用，所有通常都会针对每个微服务自行封装一些客户端类来包装这些依赖服务的调用。所以，feign在此基础上做了进一步封装，由它来帮助我们定义和实现依赖服务接口的定义，在feign的实现下，我们只需要创建一个接口并使用注解的方式来配置它(类似于以前Dao接口上标注Mapper注解，现在是一个微服务接口上面标注一个Feign注解即可)即可完成对服务提供方的接口绑定，简化了使用spring cloud ribbon时，自动封装服务调用客户端的开发量。



#### 16、什么是 Hystrix断路器

Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等。Hytrix能保证在一个依赖出问题的情况下，不会导致整体服务失败、避免级联故障，以提高分布式系统的弹性。



#### 17、Hystrix断路器能干嘛？

断路器本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控(类似熔断保险丝)，向调用方返回一个符合预期的、可处理的备选响应(FallBack)，而不是长时间的等待或者抛出调用方无法处理的异常，这样就保证了服务调用方的线程不会被长时间、不必要的占用、从而避免了故障在分布式系统中的蔓延乃至雪崩。



#### 18、什么是 zuul路由网关

Zuul包含了对请求的路由和过滤两个最主要的功能。

其中路由功能负责将外部请求转发到具体的微服务实例上，是实现外部访问统一入口的基础。而过滤器功能则负责对请求的处理过程进行干预，是实现请求校验、服务聚合等功能的基础。Zuul与Eureka进行整合，将Zuul自身注册为Eureka服务治理下的应用，同时从Eureka中获得其他微服务的消息，也即以后的访问微服务都是通过Zuul跳转后获得。



#### 19、什么是Spring Cloud Config分布式配置中心

spring cloud config分为服务端和客户端两部分。

服务端也成为分布式配置中心，它是一个独立的微服务应用，用来连接配置服务器并为客户端提供获取配置信息，加密/解密信息等访问接口。

客户端是通过指定的配置中心来管理应用资源，以及与业务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息，配置服务器默认采用git来存储配置信息，这样就有助于对环境配置进行版本管理，并且可以通过git客户端工具来方便的管理和访问配置内容。



#### 20、分布式配置中心能干嘛？

> 集中管理配置文件。
>
> 不同环境不同配置，动态化的配置更新，分环境部署比如dev/test/prod/beta/release。
>
> 运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，服务会向配置中心统一拉取配置自己的信息。
>
> 当配置发生变动时，服务不需要重启即可感知到配置的变化并应用新的配置。
>
> 将配置信息以rest接口的形式暴露。

